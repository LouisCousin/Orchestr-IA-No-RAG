# Orchestr'IA - Configuration par défaut

# Identifiant utilisateur par défaut (mono-utilisateur, prêt multi-utilisateur)
default_user_id: "user_default"

# Fournisseur IA par défaut
default_provider: "openai"
default_model: "gpt-4o"

# Paramètres de génération
generation:
  temperature: 0.7
  max_tokens: 4096
  top_p: 1.0
  frequency_penalty: 0.0
  presence_penalty: 0.0
  number_of_passes: 1

# Mode par défaut
mode: "manual"  # "manual" ou "agentic"

# Checkpoints HITL (mode manuel)
checkpoints:
  after_plan_validation: true
  after_corpus_acquisition: false
  after_extraction: false
  after_prompt_generation: false
  after_generation: false
  final_review: true

# Acquisition du corpus
corpus_acquisition:
  connection_timeout: 15
  read_timeout: 60
  slow_mode_connection_timeout: 30
  slow_mode_read_timeout: 120
  throttle_delay: 1.0
  user_agent: "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36"

# Taille cible du document
target_pages: null  # null = automatique

# Charte graphique par défaut (Forgescom)
styling:
  primary_color: "#F0C441"
  secondary_color: "#4E4E50"
  font_title: "Calibri"
  font_body: "Calibri"
  font_size_title: 16
  font_size_body: 11
  margin_top_cm: 2.5
  margin_bottom_cm: 2.5
  margin_left_cm: 2.5
  margin_right_cm: 2.5
  logo_path: null

# Chemins
paths:
  projects: "projects"
  output: "output"
  templates: "templates"
  profiles: "profiles"
  config: "config"

# Retry API
api_retry:
  max_retries: 3
  base_delay: 2.0
  max_delay: 60.0

# Estimation de coûts
cost_estimation:
  enabled: true
  warn_threshold_usd: 5.0

# ── Extraction PDF (Phase 2.5) ──
pdf_extraction:
  docling_page_batch_size: 30        # Pages par lot pour Docling
  docling_batch_threshold: 50        # Seuil de pages pour activer le batch
  coverage_threshold: 0.80           # Ratio min de pages couvertes avant rattrapage pymupdf
  disable_page_images: true          # Désactiver la génération d'images de pages
  disable_picture_classification: true  # Désactiver la classification d'images
  disable_ocr: true                  # Désactiver l'OCR (inutile pour les PDF numériques)

# ═══════════════════════════════════════════
# Phase 2.5 — Pipeline RAG complet
# ═══════════════════════════════════════════

rag:
  # ── Chunking sémantique ──
  chunking:
    strategy: "semantic"           # "semantic" | "fixed"
    max_chunk_tokens: 800
    min_chunk_tokens: 100
    overlap_sentences: 2

  # ── Embeddings ──
  embedding_mode: "local"          # "local" | "api"
  local_model: "intfloat/multilingual-e5-large"
  models_cache_dir: "./models"

  # ── Recherche ──
  top_k: 10                        # Blocs après reranking (Phase 2 : 7)
  relevance_threshold: 0.3
  initial_candidates: 20           # Blocs retournés par ChromaDB avant reranking
  cosine_distance: "cosine"

  # ── Reranking ──
  reranking_enabled: true          # true | false
  reranker_model: "cross-encoder/ms-marco-MiniLM-L-12-v2"

  # ── Filtrage ──
  filter_by_language: true         # Filtrer par langue du projet
  filter_by_doc_type: false        # Filtrer par type de document

# Phase 2 — Génération conditionnelle
conditional_generation:
  enabled: true
  sufficient_threshold: 0.5
  insufficient_threshold: 0.3
  min_relevant_blocks: 3

# ── Mode batch ──
batch:
  enabled: true
  poll_interval_seconds: 30
  timeout_seconds: 3600            # 60 minutes
  fallback_to_realtime: true       # Si batch échoue, repasser en temps réel

# ── Anti-hallucination (Phase 2.5) ──
anti_hallucination:
  enabled: true                    # Injecter le bloc dans les prompts
  needs_source_marker: "{{NEEDS_SOURCE: %s}}"
  warn_on_export: true             # Alerter si marqueurs résiduels

# ── Liaison plan-corpus (Phase 2.5) ──
plan_corpus_linking:
  enabled: true                    # Activer la pré-analyse du corpus
  max_intro_chunks_per_doc: 3      # Chunks à extraire par document
  max_documents_for_theme: 30      # Limite pour l'analyse thématique

# ═══════════════════════════════════════════
# Phase 3 — Intelligence du pipeline
# ═══════════════════════════════════════════

# ── Évaluation de la qualité ──
quality_evaluation:
  enabled: true
  auto_refine_threshold: 3.0          # Score global min avant raffinement auto
  weights:                             # Pondérations des critères
    plan_conformity: 1.0
    corpus_coverage: 1.5
    narrative_coherence: 0.8
    target_size: 0.5
    factual_reliability: 1.5
    source_traceability: 1.2
  evaluation_model: null               # null = modèle le plus économique

# ── Vérification factuelle ──
factcheck:
  enabled: true
  auto_correct_threshold: 80           # Score min (%) avant correction auto
  max_claims_per_section: 30           # Limite d'affirmations analysées
  factcheck_model: null                # null = modèle le plus économique

# ── Feedback loop ──
feedback_loop:
  enabled: true
  min_diff_ratio: 0.15                 # Seuil min de différence (Levenshtein)
  analysis_model: null                 # null = modèle de brouillon

# ── Glossaire ──
glossary:
  enabled: false                       # Désactivé par défaut (optionnel)
  max_terms_per_prompt: 15
  auto_generate: true                  # Proposition automatique après plan

# ── Citations APA ──
citations:
  enabled: false                       # Désactivé par défaut
  format: "apa7"                       # Format de référence
  include_page_numbers: true           # Inclure les numéros de page

# ── GROBID ──
grobid:
  enabled: false                       # Désactivé par défaut (Docker requis)
  server_url: "http://localhost:8070"
  timeout_seconds: 30
  consolidate_header: true
  batch_size: 5

# ── Personas ──
personas:
  enabled: false                       # Désactivé par défaut (optionnel)
  auto_suggest: true                   # Suggestion automatique par l'IA

# ── Dashboard ──
dashboard:
  refresh_interval_seconds: 5
  max_log_entries: 100
